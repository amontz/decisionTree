library('foreign')
library('Matrix')
library('randomForest')
library('pROC')

logloss <- function(y, p) {
  N <- length(y)
  -1/N*sum((y*log(p) + (1-y)*log(p)))
}

grad <- read.dta("http://www.ats.ucla.edu/stat/data/ologit.dta")
levels(grad$apply) <- c("unlikely", "likely", "likely")
grad$apply <- as.integer(grad$apply) - 1
grad$pared <- factor(grad$pared)
grad$public <- factor(grad$public)
grad$gpa <- factor(round(grad$gpa/ 0.5)*0.5)

grad_dm <- model.matrix(apply ~ pared + public + gpa - 1, data=grad)

set.seed(42)
idx <- sample(1:nrow(grad_dm), 0.7*nrow(grad_dm))
train_x <- grad_dm[idx,]
test_x <- grad_dm[-idx,]
train_y <- grad[idx, "apply"]
test_y <- grad[-idx, "apply"]

rf_grad <- randomForest(x=train_x, y=train_y, ntree=100, mtry=4)
preds_grad <- predict(rf_grad, newdata = test_x)

logloss(test_y, preds_grad)
auc(test_y, preds_grad)

preds_rand <- sample(nrow(test_x))
logloss(test_y, preds_rand)
auc(test_y, preds_rand)

write.csv(cbind(train_x, apply=train_y), file = "./grad_train.csv", row.names=FALSE)
write.csv(cbind(test_x, apply=test_y), file = "./grad_test.csv", row.names=FALSE)

preds_scala <- c(0.44076638498275605, 0.20491144966144956, 0.44076638498275605, 0.7914687330643211, 0.9180202020202022, 0.29179096441193214, 0.3837478703708836, 0.8660846097053658, 0.3761536591709762, 0.29179096441193214, 0.35651219904278714, 0.44076638498275605, 0.44076638498275605, 0.3761536591709762, 0.8660846097053658, 0.44076638498275605, 0.3761536591709762, 0.44076638498275605, 0.3761536591709762, 0.8660846097053658, 0.3761536591709762, 0.35651219904278714, 0.44076638498275605, 0.3761536591709762, 0.3761536591709762, 0.7179060488445161, 0.3837478703708836, 0.35651219904278714, 0.29179096441193214, 0.3761536591709762, 0.3837478703708836, 0.7914687330643211, 0.8660846097053658, 0.4652647352647352, 0.44076638498275605, 0.44076638498275605, 0.7914687330643211, 0.29179096441193214, 0.3837478703708836, 0.44076638498275605, 0.6142222222222222, 0.3761536591709762, 0.3761536591709762, 0.3761536591709762, 0.44076638498275605, 0.8660846097053658, 0.3761536591709762, 0.3837478703708836, 0.3761536591709762, 0.44076638498275605, 0.35651219904278714, 0.3761536591709762, 0.3837478703708836, 0.8660846097053658, 0.3761536591709762, 0.3761536591709762, 0.3761536591709762, 0.44076638498275605, 0.35651219904278714, 0.3761536591709762, 0.3837478703708836, 0.7914687330643211, 0.35651219904278714, 0.3761536591709762, 0.35651219904278714, 0.3761536591709762, 0.3761536591709762, 0.3837478703708836, 0.3837478703708836, 0.3761536591709762, 0.35651219904278714, 0.3761536591709762, 0.44076638498275605, 0.44076638498275605, 0.3761536591709762, 0.44076638498275605, 0.44076638498275605, 0.8660846097053658, 0.3761536591709762, 0.3761536591709762, 0.7914687330643211, 0.3761536591709762, 0.7914687330643211, 0.44076638498275605, 0.3837478703708836, 0.7914687330643211, 0.3761536591709762, 0.3761536591709762, 0.44076638498275605, 0.3761536591709762, 0.3837478703708836, 0.3761536591709762, 0.20491144966144956, 0.3837478703708836, 0.29179096441193214, 0.14829511562969683, 0.3761536591709762, 0.4652647352647352, 0.44076638498275605, 0.3761536591709762, 0.29179096441193214, 0.3761536591709762, 0.3761536591709762, 0.3761536591709762, 0.4652647352647352, 0.3761536591709762, 0.3837478703708836, 0.7914687330643211, 0.3761536591709762, 0.14829511562969683, 0.3837478703708836, 0.9180202020202022, 0.44076638498275605, 0.3761536591709762, 0.44076638498275605, 0.29179096441193214, 0.3837478703708836, 0.3837478703708836, 0.14829511562969683, 0.3837478703708836)
logloss(test_y, preds_scala)
auc(test_y, preds_scala)

